# ç¢°å—’ç¢°å—’ (PONT-PONTA) - AIæ™ºèƒ½ä½“ç›²ç›’å¹³å°

> ğŸ é€šè¿‡NFCèŠ¯ç‰‡ç¢°ä¸€ç¢°,å”¤é†’ä½ çš„ä¸“å±AIæ™ºèƒ½ä½“ä¼™ä¼´!
>
> ğŸ’¡ åˆ›æ–°çš„"å®ä½“+è™šæ‹Ÿ"äº§å“æ¨¡å¼,ç»“åˆAIå¯¹è¯æŠ€æœ¯å’Œç›²ç›’ç©æ³•,ä¸ºç”¨æˆ·å¸¦æ¥ç‹¬ç‰¹çš„äº’åŠ¨ä½“éªŒ

[![Next.js](https://img.shields.io/badge/Next.js-16.1.1-black?style=flat&logo=next.js)](https://nextjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.9-blue?style=flat&logo=typescript)](https://www.typescriptlang.org/)
[![Prisma](https://img.shields.io/badge/Prisma-5.22-2D3748?style=flat&logo=prisma)](https://www.prisma.io/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

---

## ğŸ“– ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [æ•°æ®åº“ç®¡ç†](#æ•°æ®åº“ç®¡ç†)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [APIæ–‡æ¡£](#apiæ–‡æ¡£)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ¯ é¡¹ç›®ç®€ä»‹

**ç¢°å—’ç¢°å—’ (PONT-PONTA)** æ˜¯ä¸€ä¸ªåˆ›æ–°çš„AIæ™ºèƒ½ä½“ç›²ç›’å¹³å°,é‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆæ„å»º,æ”¯æŒå¤šç§AIæœåŠ¡æä¾›å•†,æä¾›å®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿã€ç›²ç›’å•†åŸã€æ¿€æ´»ç ç³»ç»Ÿå’ŒAIå¯¹è¯åŠŸèƒ½ã€‚

### ğŸŒŸ æ ¸å¿ƒç‰¹è‰²

- **ğŸ ç›²ç›’ç©æ³•** - ç³»åˆ—ç›²ç›’é”€å”®,éšæœºè·å¾—ä¸åŒç¨€æœ‰åº¦çš„AIæ™ºèƒ½ä½“
- **ğŸ”‘ æ¿€æ´»ç ç³»ç»Ÿ** - é€šè¿‡æ¿€æ´»ç è§£é”æ™ºèƒ½ä½“,æ”¯æŒæ‰¹é‡ç”Ÿæˆå’Œç®¡ç†
- **ğŸ¤– åŒAIå¼•æ“** - æ”¯æŒCoze APIå’ŒOpenAIå…¼å®¹æ¥å£(å¦‚DeepSeekã€SiliconFlowç­‰)
- **ğŸ’¬ æµå¼å¯¹è¯** - åŸºäºSSEçš„å®æ—¶AIå¯¹è¯,æ™ºèƒ½ä½“å…·å¤‡è®°å¿†èƒ½åŠ›
- **ğŸ‘¤ å®Œæ•´ç”¨æˆ·ç³»ç»Ÿ** - æ³¨å†Œç™»å½•ã€ä¸ªäººä¸­å¿ƒã€æˆ‘çš„æ™ºèƒ½ä½“
- **ğŸ”§ åå°ç®¡ç†** - ç³»åˆ—ç®¡ç†ã€æ™ºèƒ½ä½“ç®¡ç†ã€æ¿€æ´»ç ç®¡ç†ã€è®¢å•ç®¡ç†
- **ğŸ¨ ç°ä»£åŒ–UI** - åŸºäºshadcn/uiçš„ç²¾ç¾ç•Œé¢,å“åº”å¼è®¾è®¡

### ğŸ“± ä¸šåŠ¡æ¨¡å¼

1. **ç”¨æˆ·è´­ä¹°ç³»åˆ—ç›²ç›’** â†’ è·å¾—éšæœºæ¿€æ´»ç 
2. **ä½¿ç”¨æ¿€æ´»ç è§£é”** â†’ æ°¸ä¹…è·å¾—è¯¥æ™ºèƒ½ä½“ä½¿ç”¨æƒ
3. **ä¸æ™ºèƒ½ä½“å¯¹è¯** â†’ äº«å—ä¸ªæ€§åŒ–AIä¼™ä¼´ä½“éªŒ

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ›’ å•†åŸåŠŸèƒ½
- âœ… ç³»åˆ—ç›²ç›’åˆ—è¡¨å±•ç¤º
- âœ… ç³»åˆ—è¯¦æƒ…é¡µ(ä»·æ ¼ã€åº“å­˜ã€åŒ…å«çš„æ™ºèƒ½ä½“)
- âœ… æ™ºèƒ½ä½“è¯¦æƒ…é¡µ(ç¨€æœ‰åº¦ã€èƒ½åŠ›æè¿°ã€æ‰€å±ç³»åˆ—)
- âœ… è´­ä¹°æµç¨‹å’Œè®¢å•ç®¡ç†

### ğŸ” è®¤è¯æˆæƒ
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•(é‚®ç®±+å¯†ç )
- âœ… JWT Tokenè®¤è¯(HttpOnly Cookie)
- âœ… ç®¡ç†å‘˜æƒé™ç³»ç»Ÿ
- âœ… å¯†ç åŠ å¯†(bcrypt)

### ğŸ¤– AIå¯¹è¯ç³»ç»Ÿ
- âœ… æ”¯æŒCoze API(è‡ªå¸¦ä¼šè¯ç®¡ç†)
- âœ… æ”¯æŒOpenAIå…¼å®¹æ¥å£(æ‰‹åŠ¨å†å²ç®¡ç†)
- âœ… SSEæµå¼å“åº”(å®æ—¶æ‰“å­—æ•ˆæœ)
- âœ… å¯¹è¯å†å²æŒä¹…åŒ–
- âœ… æ™ºèƒ½ä½“è®°å¿†åŠŸèƒ½(conversationId)

### ğŸ« æ¿€æ´»ç ç³»ç»Ÿ
- âœ… æ ¼å¼: PONTA + 10ä½éšæœºå­—ç¬¦
- âœ… æ‰¹é‡ç”Ÿæˆæ¿€æ´»ç 
- âœ… CSVå¯¼å‡ºæ¿€æ´»ç åˆ—è¡¨
- âœ… æ¿€æ´»çŠ¶æ€è·Ÿè¸ª(UNUSED/ACTIVATED)
- âœ… é˜²é‡å¤æ¿€æ´»(ç”¨æˆ·+æ™ºèƒ½ä½“å”¯ä¸€æ€§çº¦æŸ)

### ğŸ¨ åå°ç®¡ç†
- âœ… ç³»åˆ—ç®¡ç†(æ–°å¢/ç¼–è¾‘/ä¸Šæ¶ä¸‹æ¶/å›¾ç‰‡ä¸Šä¼ )
- âœ… æ™ºèƒ½ä½“ç®¡ç†(æ–°å¢/ç¼–è¾‘/æ”¯æŒåŒProvideré…ç½®)
- âœ… æ¿€æ´»ç ç®¡ç†(ç”Ÿæˆ/æŸ¥çœ‹çŠ¶æ€/å¯¼å‡ºCSV)
- âœ… è®¢å•ç®¡ç†(æŸ¥çœ‹/çŠ¶æ€æ›´æ–°)
- âœ… ç”¨æˆ·ç®¡ç†(æŸ¥çœ‹/æƒé™ç®¡ç†)

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Next.js | 16.1.1 | Reactæ¡†æ¶,App Routeræ¶æ„ |
| React | 19.2.3 | UIåº“ |
| TypeScript | 5.9.3 | ç±»å‹å®‰å…¨ |
| Tailwind CSS | 4.x | æ ·å¼æ¡†æ¶ |
| shadcn/ui | latest | é«˜è´¨é‡UIç»„ä»¶åº“ |
| React Hook Form | latest | è¡¨å•ç®¡ç† |
| Zod | latest | SchemaéªŒè¯ |
| Sonner | latest | Toasté€šçŸ¥ |

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Next.js API Routes | - | RESTful API |
| Prisma ORM | 5.22.0 | æ•°æ®åº“ORM |
| PostgreSQL | 16+ | ç”Ÿäº§æ•°æ®åº“ |
| jose | latest | JWT Tokenç”Ÿæˆå’ŒéªŒè¯ |
| bcrypt | latest | å¯†ç åŠ å¯† |
| Coze API SDK | latest | AIå¯¹è¯(Coze Provider) |
| OpenAI SDK | - | AIå¯¹è¯(OpenAIå…¼å®¹) |

### AI Provideræ¶æ„

```
AI Provideræ¥å£
â”œâ”€â”€ CozeProvider (ç»´æŠ¤ä¼šè¯çŠ¶æ€)
â”‚   â”œâ”€â”€ Bot ID + API Token
â”‚   â”œâ”€â”€ è‡ªåŠ¨ç®¡ç†conversationId
â”‚   â””â”€â”€ æµå¼å“åº”
â””â”€â”€ OpenAIProvider (æ‰‹åŠ¨ä¼ é€’å†å²)
    â”œâ”€â”€ Endpoint + API Key + Model
    â”œâ”€â”€ System Promptæ”¯æŒ
    â””â”€â”€ é™åˆ¶å†å²æ¶ˆæ¯æ•°é‡(20æ¡)
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Node.js**: 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **pnpm**: 8.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Git**: æœ€æ–°ç‰ˆæœ¬

### 1ï¸âƒ£ å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/emajjsky/pontaponta.git
cd pontaponta
```

### 2ï¸âƒ£ å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨pnpmå®‰è£…(æ¨è)
pnpm install

# æˆ–ä½¿ç”¨npm
npm install
```

### 3ï¸âƒ£ é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶:

```env
# JWTå¯†é’¥(ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²!)
JWT_SECRET="your-secret-key-change-in-production"

# Coze APIé…ç½®(å¯é€‰,å¦‚æœä½¿ç”¨Coze Provider)
COZE_API_TOKEN="sat_xxx..."
COZE_BOT_ID="7428933434510770211"

# æ•°æ®åº“è¿æ¥(å¼€å‘/ç”Ÿäº§ç¯å¢ƒå‡ä½¿ç”¨PostgreSQL)
DATABASE_URL="postgresql://user:password@localhost:5432/pontaponta"

# OpenAIå…¼å®¹APIé…ç½®(å¯é€‰,å¦‚æœä½¿ç”¨OpenAI Provider)
# OPENAI_API_KEY="sk-xxx..."
# OPENAI_API_BASE="https://api.siliconflow.cn/v1/chat/completions"
```

### 4ï¸âƒ£ æ•°æ®åº“åˆå§‹åŒ–

```bash
# ç”ŸæˆPrismaå®¢æˆ·ç«¯
pnpm prisma generate

# è¿è¡Œæ•°æ®åº“è¿ç§»(å¼€å‘ç¯å¢ƒ)
pnpm prisma migrate dev

# å¡«å……ç§å­æ•°æ®(æµ‹è¯•è´¦å·å’Œç¤ºä¾‹æ™ºèƒ½ä½“)
pnpm prisma db seed
```

**ç§å­æ•°æ®åŒ…å«:**
- ğŸ‘¨â€ğŸ’¼ ç®¡ç†å‘˜è´¦å·: `admin@ponta-ponta.com` / `password123`
- ğŸ“§ æµ‹è¯•ç”¨æˆ·: `test@example.com` / `password123`
- ğŸ”‘ æµ‹è¯•æ¿€æ´»ç : `PONTA1234567890`ã€`PONTA5D1A5WQ58P`

### 5ï¸âƒ£ å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨(localhost:3000)
pnpm dev

# æˆ–ä½¿ç”¨Turbopack(æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦)
pnpm dev --turbo
```

è®¿é—® [http://localhost:3000](http://localhost:3000) æŸ¥çœ‹åº”ç”¨

### 6ï¸âƒ£ æ•°æ®åº“å¯è§†åŒ–ç®¡ç†(å¯é€‰)

```bash
# å¯åŠ¨Prisma Studio
pnpm prisma studio

# è®¿é—® http://localhost:5555
```

---

## ğŸ”§ ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ

- **æ•°æ®åº“**: PostgreSQL
- **ç«¯å£**: 3000
- **çƒ­é‡è½½**: âœ… æ”¯æŒ
- **APIè°ƒè¯•**: âœ… æ”¯æŒ

### ç”Ÿäº§ç¯å¢ƒ

- **æ•°æ®åº“**: PostgreSQL 16+
- **è¿›ç¨‹ç®¡ç†**: PM2
- **åå‘ä»£ç†**: Nginx
- **SSLè¯ä¹¦**: Let's Encrypt (Certbot)

### ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | å¿…éœ€ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `JWT_SECRET` | âœ… | JWTç­¾åå¯†é’¥ | å¼ºéšæœºå­—ç¬¦ä¸²,è‡³å°‘32ä½ |
| `DATABASE_URL` | âœ… | æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² | `postgresql://user:pass@host:5432/db` |
| `COZE_API_TOKEN` | âŒ | Coze APIå¯†é’¥ | `sat_xxx...` |
| `COZE_BOT_ID` | âŒ | Cozeæœºå™¨äººID | `7428933434510770211` |
| `COZE_API_BASE_URL` | âŒ | Coze APIåŸºç¡€URL | `https://api.coze.cn` (é»˜è®¤) |
| `NODE_ENV` | âŒ | è¿è¡Œç¯å¢ƒ | `development` / `production` |

---

## ğŸ’¾ æ•°æ®åº“ç®¡ç†

### Prisma CLIå‘½ä»¤

```bash
# ç”ŸæˆPrismaå®¢æˆ·ç«¯
pnpm prisma generate

# åˆ›å»ºæ–°è¿ç§»(å¼€å‘ç¯å¢ƒ)
pnpm prisma migrate dev --name migration_name

# åº”ç”¨è¿ç§»(ç”Ÿäº§ç¯å¢ƒ)
pnpm prisma migrate deploy

# æ‰“å¼€Prisma Studio
pnpm prisma studio

# é‡ç½®æ•°æ®åº“(å±é™©æ“ä½œ!)
pnpm prisma migrate reset

# å¡«å……ç§å­æ•°æ®
pnpm prisma db seed
```

### æ•°æ®æ¨¡å‹å…³ç³»

```
User (ç”¨æˆ·)
  â”œâ”€â†’ Order[] (è®¢å•)
  â”œâ”€â†’ UserAgent[] (æ‹¥æœ‰çš„æ™ºèƒ½ä½“)
  â”œâ”€â†’ ActivationCode[] (åˆ›å»ºçš„æ¿€æ´»ç )
  â””â”€â†’ ChatHistory[] (å¯¹è¯å†å²)

Series (ç³»åˆ—)
  â”œâ”€â†’ Agent[] (åŒ…å«çš„æ™ºèƒ½ä½“)
  â””â”€â†’ Order[] (è¯¥ç³»åˆ—çš„è®¢å•)

Agent (æ™ºèƒ½ä½“)
  â”œâ”€â†’ series (æ‰€å±ç³»åˆ—)
  â”œâ”€â†’ Order[] (è¢«è´­ä¹°çš„è®¢å•)
  â”œâ”€â†’ UserAgent[] (è¢«æ¿€æ´»çš„å®ä¾‹)
  â”œâ”€â†’ ActivationCode[] (å…³è”çš„æ¿€æ´»ç )
  â””â”€â†’ ChatHistory[] (å¯¹è¯å†å²)

Order (è®¢å•)
  â”œâ”€â†’ user (è´­ä¹°ç”¨æˆ·)
  â”œâ”€â†’ series (è´­ä¹°çš„ç³»åˆ—,å¯é€‰)
  â”œâ”€â†’ agent (ç›´æ¥è´­ä¹°çš„æ™ºèƒ½ä½“,å…¼å®¹æ—§æ•°æ®)
  â””â”€â†’ activationCode (å…³è”çš„æ¿€æ´»ç )

ActivationCode (æ¿€æ´»ç )
  â”œâ”€â†’ agent (å±äºå“ªä¸ªæ™ºèƒ½ä½“)
  â”œâ”€â†’ user (è¢«å“ªä¸ªç”¨æˆ·æ¿€æ´»)
  â”œâ”€â†’ order (å…³è”è®¢å•,å¯é€‰)
  â””â”€â†’ userAgent (æ¿€æ´»ååˆ›å»ºçš„å®ä¾‹)

UserAgent (ç”¨æˆ·æ™ºèƒ½ä½“å®ä¾‹)
  â”œâ”€â†’ user (æ‰€å±ç”¨æˆ·)
  â”œâ”€â†’ agent (å¯¹åº”çš„æ™ºèƒ½ä½“)
  â”œâ”€â†’ activationCode (ä½¿ç”¨çš„æ¿€æ´»ç )
  â””â”€â†’ ChatHistory[] (å¯¹è¯å†å²)
```

---

## ğŸ“š å¼€å‘æŒ‡å—

### é¡¹ç›®ç›®å½•ç»“æ„

```
pontaponta/
â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/              # è®¤è¯é¡µé¢ç»„(å…±äº«layout)
â”‚   â”‚   â”œâ”€â”€ login/           # ç™»å½•é¡µé¢
â”‚   â”‚   â””â”€â”€ register/        # æ³¨å†Œé¡µé¢
â”‚   â”œâ”€â”€ (shop)/              # å•†åŸé¡µé¢ç»„(å…±äº«layout)
â”‚   â”‚   â”œâ”€â”€ page.tsx         # å•†åŸé¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ series/          # ç³»åˆ—è¯¦æƒ…
â”‚   â”‚   â””â”€â”€ agents/          # æ™ºèƒ½ä½“åˆ—è¡¨
â”‚   â”œâ”€â”€ admin/               # åå°ç®¡ç†(éœ€è¦ADMINæƒé™)
â”‚   â”‚   â”œâ”€â”€ agents/          # æ™ºèƒ½ä½“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ series/          # ç³»åˆ—ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ activation-codes/ # æ¿€æ´»ç ç®¡ç†
â”‚   â”‚   â””â”€â”€ orders/          # è®¢å•ç®¡ç†
â”‚   â”œâ”€â”€ chat/                # AIå¯¹è¯é¡µé¢
â”‚   â”œâ”€â”€ my-agents/           # æˆ‘çš„æ™ºèƒ½ä½“
â”‚   â””â”€â”€ api/                 # APIè·¯ç”±
â”‚       â”œâ”€â”€ auth/            # è®¤è¯API
â”‚       â”œâ”€â”€ agents/          # æ™ºèƒ½ä½“API
â”‚       â”œâ”€â”€ shop/            # å•†åŸAPI
â”‚       â”œâ”€â”€ activate/        # æ¿€æ´»ç API
â”‚       â””â”€â”€ admin/           # åå°ç®¡ç†API
â”œâ”€â”€ components/               # Reactç»„ä»¶
â”‚   â”œâ”€â”€ ui/                  # shadcn/uiåŸºç¡€ç»„ä»¶
â”‚   â”œâ”€â”€ auth/                # è®¤è¯ç»„ä»¶
â”‚   â”œâ”€â”€ agents/              # æ™ºèƒ½ä½“ç»„ä»¶
â”‚   â”œâ”€â”€ chat/                # èŠå¤©ç»„ä»¶
â”‚   â”œâ”€â”€ admin/               # åå°ç®¡ç†ç»„ä»¶
â”‚   â””â”€â”€ layout/              # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ lib/                     # å·¥å…·åº“
â”‚   â”œâ”€â”€ providers/           # AI Providerå®ç°
â”‚   â”‚   â”œâ”€â”€ coze.ts         # Coze Provider
â”‚   â”‚   â””â”€â”€ openai.ts       # OpenAI Provider
â”‚   â”œâ”€â”€ ai-provider.ts       # Provideræ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ jwt.ts               # JWTå·¥å…·
â”‚   â”œâ”€â”€ auth.ts              # è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ admin.ts             # ç®¡ç†å‘˜æƒé™æ£€æŸ¥
â”‚   â”œâ”€â”€ coze.ts              # Coze APIé›†æˆ
â”‚   â”œâ”€â”€ activation.ts        # æ¿€æ´»ç å·¥å…·
â”‚   â”œâ”€â”€ prisma.ts            # Prismaå®¢æˆ·ç«¯
â”‚   â””â”€â”€ utils.ts             # é€šç”¨å·¥å…·
â”œâ”€â”€ prisma/                  # Prismaé…ç½®
â”‚   â”œâ”€â”€ schema.prisma        # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ seed.ts              # åŸºç¡€ç§å­æ•°æ®
â”‚   â””â”€â”€ seed-series-data.ts  # ç³»åˆ—æ™ºèƒ½ä½“æ•°æ®
â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”‚   â””â”€â”€ uploads/             # ä¸Šä¼ çš„å›¾ç‰‡
â”œâ”€â”€ middleware.ts            # Next.jsä¸­é—´ä»¶(è·¯ç”±ä¿æŠ¤)
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ .env                     # ç¯å¢ƒå˜é‡
```

### æ·»åŠ æ–°çš„æ™ºèƒ½ä½“

**æ–¹å¼1: é€šè¿‡åå°ç•Œé¢æ·»åŠ **

1. ç™»å½•ç®¡ç†å‘˜è´¦å· (`admin@ponta-ponta.com`)
2. è®¿é—® `/admin/agents/new`
3. é€‰æ‹©Providerç±»å‹:
   - **COZE**: è¾“å…¥Bot IDå’ŒAPI Token
   - **OPENAI**: è¾“å…¥Endpointã€API Keyã€Modelã€System Prompt
4. å¡«å†™æ™ºèƒ½ä½“åç§°ã€Slugã€æè¿°ç­‰
5. ä¸Šä¼ å¤´åƒå›¾ç‰‡
6. é€‰æ‹©ç¨€æœ‰åº¦å’Œæ‰€å±ç³»åˆ—
7. ä¿å­˜

**æ–¹å¼2: é€šè¿‡æ•°æ®åº“ç›´æ¥æ·»åŠ **

```sql
-- Coze Provider
INSERT INTO agents (name, slug, provider, "providerConfig", rarity, "seriesId")
VALUES (
  'æ™ºèƒ½ä½“åç§°',
  'agent-slug',
  'COZE',
  '{"botId": "7428933434510770211", "apiToken": "sat_xxx..."}',
  'COMMON',
  'series-id'
);

-- OpenAI Provider
INSERT INTO agents (name, slug, provider, "providerConfig", "systemPrompt", rarity)
VALUES (
  'æ™ºèƒ½ä½“åç§°',
  'agent-slug',
  'OPENAI',
  '{"endpoint": "https://api.siliconflow.cn/v1/chat/completions", "apiKey": "sk-xxx...", "model": "deepseek-chat"}',
  'ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹',
  'RARE'
);
```

### æ‰¹é‡ç”Ÿæˆæ¿€æ´»ç 

1. ç™»å½•åå°ç®¡ç†
2. è¿›å…¥"æ¿€æ´»ç ç®¡ç†"
3. é€‰æ‹©æ™ºèƒ½ä½“
4. è¾“å…¥ç”Ÿæˆæ•°é‡
5. ç‚¹å‡»"ç”Ÿæˆæ¿€æ´»ç "
6. ç‚¹å‡»"å¯¼å‡ºCSV"ä¸‹è½½æ¿€æ´»ç åˆ—è¡¨

### è‡ªå®šä¹‰AI Provider

æ‰€æœ‰Providerå¿…é¡»å®ç° `AIProvider` æ¥å£:

```typescript
// lib/ai-provider.ts
export interface AIProvider {
  /**
   * å‘é€æ¶ˆæ¯å¹¶è·å–æµå¼å“åº”
   */
  chat(
    message: string,
    conversationId?: string,
    history?: ChatMessage[],
    options?: ChatOptions
  ): AsyncIterable<ChatChunk>

  /**
   * è·å–provideråç§°
   */
  getName(): string
}
```

å‚è€ƒ `lib/providers/coze.ts` æˆ– `lib/providers/openai.ts` å®ç°æ–°çš„Providerã€‚

---

## ğŸ“¡ APIæ–‡æ¡£

### è®¤è¯ç›¸å…³

#### POST `/api/auth/register`
**ç”¨æˆ·æ³¨å†Œ**

**è¯·æ±‚ä½“:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "nickname": "æ˜µç§°"
}
```

**å“åº”:**
```json
{
  "success": true,
  "user": {
    "id": "user-id",
    "email": "user@example.com",
    "nickname": "æ˜µç§°"
  }
}
```

#### POST `/api/auth/login`
**ç”¨æˆ·ç™»å½•**

**è¯·æ±‚ä½“:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**å“åº”:**
```json
{
  "success": true,
  "user": {
    "id": "user-id",
    "email": "user@example.com",
    "role": "USER"
  }
}
```

**Tokenå­˜å‚¨åœ¨HttpOnly Cookieä¸­**

### æ™ºèƒ½ä½“ç›¸å…³

#### GET `/api/agents`
**è·å–æ™ºèƒ½ä½“åˆ—è¡¨(å…¬å¼€æ¥å£)**

**æŸ¥è¯¢å‚æ•°:**
- `series` (å¯é€‰): ç³»åˆ—ID,ç­›é€‰ç‰¹å®šç³»åˆ—çš„æ™ºèƒ½ä½“

**å“åº”:**
```json
{
  "agents": [
    {
      "id": "agent-id",
      "name": "è¿ªè¿¦å¥¥ç‰¹æ›¼",
      "slug": "ultraman-tiga",
      "avatar": "/uploads/xxx.jpg",
      "rarity": "LEGENDARY",
      "seriesId": "series-id"
    }
  ]
}
```

#### GET `/api/agents/[slug]`
**è·å–æ™ºèƒ½ä½“è¯¦æƒ…**

**å“åº”:**
```json
{
  "agent": {
    "id": "agent-id",
    "name": "è¿ªè¿¦å¥¥ç‰¹æ›¼",
    "slug": "ultraman-tiga",
    "description": "æ¥è‡ªM78æ˜Ÿäº‘çš„å…‰ä¹‹å·¨äºº",
    "abilities": ["é£è¡Œ", "å…‰çº¿æŠ€èƒ½"],
    "rarity": "LEGENDARY",
    "series": {
      "id": "series-id",
      "name": "å¥¥ç‰¹æ›¼ç³»åˆ—",
      "slug": "ultraman"
    }
  }
}
```

### å•†åŸç›¸å…³

#### GET `/api/shop/series`
**è·å–ç³»åˆ—ç›²ç›’åˆ—è¡¨**

**å“åº”:**
```json
{
  "series": [
    {
      "id": "series-id",
      "name": "å¥¥ç‰¹æ›¼ç³»åˆ—",
      "slug": "ultraman",
      "coverImage": "/uploads/xxx.jpg",
      "description": "æ”¶é›†å…‰ä¹‹å·¨äºº",
      "price": 59,
      "stock": 100,
      "isActive": true,
      "order": 0,
      "agentsCount": 6
    }
  ]
}
```

#### GET `/api/shop/series/[slug]`
**è·å–ç³»åˆ—è¯¦æƒ…**

**å“åº”:**
```json
{
  "series": {
    "id": "series-id",
    "name": "å¥¥ç‰¹æ›¼ç³»åˆ—",
    "agents": [
      {
        "id": "agent-id",
        "name": "è¿ªè¿¦å¥¥ç‰¹æ›¼",
        "rarity": "LEGENDARY"
      }
    ]
  }
}
```

### å¯¹è¯ç›¸å…³

#### POST `/api/chat`
**ä¸æ™ºèƒ½ä½“å¯¹è¯(éœ€è¦è®¤è¯)**

**è¯·æ±‚ä½“:**
```json
{
  "agentSlug": "ultraman-tiga",
  "message": "ä½ å¥½!",
  "conversationId": "optional-conversation-id"
}
```

**å“åº”:** Server-Sent Events (SSE) æµ

```
data: {"event":"delta","content":"ä½ å¥½"}

data: {"event":"delta","content":"!æˆ‘æ˜¯"}

data: {"event":"delta","content":"è¿ªè¿¦"}

data: {"event":"completed","conversationId":"conv-id"}
```

### æ¿€æ´»ç ç›¸å…³

#### POST `/api/activate`
**æ¿€æ´»æ™ºèƒ½ä½“(éœ€è¦è®¤è¯)**

**è¯·æ±‚ä½“:**
```json
{
  "code": "PONTA1234567890"
}
```

**å“åº”:**
```json
{
  "success": true,
  "agent": {
    "id": "agent-id",
    "name": "è¿ªè¿¦å¥¥ç‰¹æ›¼",
    "slug": "ultraman-tiga"
  },
  "userAgentId": "user-agent-id"
}
```

**é”™è¯¯å“åº”:**
```json
{
  "error": "æ¿€æ´»ç ä¸å­˜åœ¨æˆ–å·²ä½¿ç”¨"
}
```

### åå°ç®¡ç†API

åå°ç®¡ç†APIéœ€è¦ç®¡ç†å‘˜æƒé™(`role: ADMIN`),ä¸»è¦åŒ…æ‹¬:

- `/api/admin/agents` - æ™ºèƒ½ä½“CRUD
- `/api/admin/series` - ç³»åˆ—CRUD
- `/api/admin/activation-codes` - æ¿€æ´»ç ç®¡ç†
- `/api/admin/orders` - è®¢å•ç®¡ç†
- `/api/admin/upload` - å›¾ç‰‡ä¸Šä¼ 

è¯¦ç»†APIæ–‡æ¡£è¯·æŸ¥çœ‹æºç ä¸­çš„å…·ä½“å®ç°ã€‚

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Verceléƒ¨ç½²(æ¨è)

1. **è¿æ¥GitHubä»“åº“åˆ°Vercel**
2. **é…ç½®ç¯å¢ƒå˜é‡:**
   - `JWT_SECRET` - å¼ºéšæœºå­—ç¬¦ä¸²
   - `DATABASE_URL` - Vercel Postgresæˆ–Supabaseè¿æ¥å­—ç¬¦ä¸²
   - `COZE_API_TOKEN` - Coze APIå¯†é’¥(å¦‚æœä½¿ç”¨Coze)
   - `COZE_BOT_ID` - Cozeæœºå™¨äººID

3. **è¿è¡Œæ•°æ®åº“è¿ç§»:**
   ```bash
   vercel env pull .env.local
   pnpm prisma migrate deploy
   pnpm prisma db seed
   ```

4. **è‡ªåŠ¨éƒ¨ç½²**: æ¨é€åˆ°GitHubä¸»åˆ†æ”¯è‡ªåŠ¨è§¦å‘éƒ¨ç½²

### è…¾è®¯äº‘/é˜¿é‡Œäº‘éƒ¨ç½²

**è¯¦ç»†çš„UbuntuæœåŠ¡å™¨éƒ¨ç½²æ­¥éª¤,è¯·æŸ¥çœ‹:** ğŸ‘‰ **[TENCENT_CLOUD_DEPLOYMENT.md](./TENCENT_CLOUD_DEPLOYMENT.md)**

è¯¥æ–‡æ¡£åŒ…å«:
- âœ… ç³»ç»Ÿç¯å¢ƒé…ç½®(Node.jsã€pnpmã€PM2)
- âœ… PostgreSQLå®‰è£…å’Œé…ç½®
- âœ… é¡¹ç›®éƒ¨ç½²å’Œæ„å»º
- âœ… Nginxåå‘ä»£ç†é…ç½®
- âœ… SSLè¯ä¹¦ç”³è¯·(HTTPS)
- âœ… åŸŸåé…ç½®
- âœ… å¸¸è§é—®é¢˜è§£å†³
- âœ… æ€§èƒ½ä¼˜åŒ–å»ºè®®
- âœ… å®‰å…¨åŠ å›º
- âœ… å¤‡ä»½ç­–ç•¥

### Dockeréƒ¨ç½²(å¯é€‰)

é¡¹ç›®æš‚æœªæä¾›Dockeré…ç½®,å¦‚éœ€å®¹å™¨åŒ–éƒ¨ç½²,å¯ä»¥å‚è€ƒä»¥ä¸‹ç»“æ„:

```dockerfile
FROM node:22-alpine AS base

# å®‰è£…ä¾èµ–
FROM base AS deps
WORKDIR /app
COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install

# æ„å»ºåº”ç”¨
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN pnpm build

# ç”Ÿäº§è¿è¡Œ
FROM base AS runner
WORKDIR /app
ENV NODE_ENV production
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static

EXPOSE 3000
CMD ["node", "server.js"]
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: æ™ºèƒ½ä½“æ²¡æœ‰è®°å¿†æ€ä¹ˆåŠ?

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:

1. **æ•°æ®åº“conversationIdå­—æ®µ:**
   ```sql
   SELECT "conversationId" FROM "ChatHistory" WHERE "userAgentId" = 'xxx' ORDER BY createdAt DESC LIMIT 5;
   ```

2. **Coze Provideré…ç½®:**
   - ç¡®ä¿ `lib/providers/coze.ts` æ­£ç¡®è¿”å› `conversationId`
   - æ£€æŸ¥ `chunk.data?.conversation_id` æ˜¯å¦æœ‰å€¼

3. **APIè·¯ç”±:**
   - æ£€æŸ¥ `app/api/chat/route.ts` æ˜¯å¦æ­£ç¡®æ•è· `actualConversationId`
   - ç¡®è®¤ `saveChatHistory` ä¿å­˜äº†æ­£ç¡®çš„ conversationId

**è§£å†³æ–¹æ¡ˆå‚è€ƒ:** å·²åœ¨ `lib/ai-provider.ts`ã€`lib/providers/coze.ts` å’Œ `app/api/chat/route.ts` ä¸­ä¿®å¤

### Q2: OpenAI Provideræ²¡æœ‰å†å²è®°å¿†?

**A:** OpenAIå…¼å®¹æ¥å£ä¸ç»´æŠ¤ä¼šè¯çŠ¶æ€,éœ€è¦æ‰‹åŠ¨ä¼ é€’å†å²:

```typescript
// app/api/chat/route.ts å·²åŒ…å«æ­¤é€»è¾‘
const history = await getChatHistory(payload.userId, agent.id, 20)
const stream = provider.chat(message, conversationId, history)
```

### Q3: æ¿€æ´»ç é‡å¤æ¿€æ´»é—®é¢˜?

**A:** Prisma Schemaå·²å®šä¹‰å”¯ä¸€æ€§çº¦æŸ:

```prisma
model UserAgent {
  @@unique([userId, agentId])  // ä¸€ä¸ªç”¨æˆ·å¯¹åŒä¸€æ™ºèƒ½ä½“åªèƒ½æ¿€æ´»ä¸€æ¬¡
}
```

### Q4: å•†åŸé¡µé¢æ˜¾ç¤º"æš‚æ— ç³»åˆ—ç›²ç›’"?

**A:** å¯èƒ½æ˜¯Next.jsç¼“å­˜é—®é¢˜:

```bash
# æ¸…é™¤æ„å»ºç¼“å­˜
rm -rf .next

# é‡æ–°æ„å»º
pnpm build

# é‡å¯åº”ç”¨
pm2 restart pontaponta
```

### Q5: æ•°æ®åº“è¿ç§»å¤±è´¥?

**A:** æ•°æ®åº“è¿ç§»å¤±è´¥æ—¶:

```bash
# åˆ é™¤æ—§çš„è¿ç§»æ–‡ä»¶
rm -rf prisma/migrations/*

# é‡æ–°è¿ç§»
pnpm prisma migrate dev --name init
```

### Q6: Coze APIè°ƒç”¨å¤±è´¥?

**A:** æ£€æŸ¥ç¯å¢ƒå˜é‡:

```bash
# æ£€æŸ¥.envæ–‡ä»¶
COZE_API_TOKEN=sat_xxx...
COZE_BOT_ID=7428933434510770211
COZE_API_BASE_URL=https://api.coze.cn  # é»˜è®¤å€¼
```

### Q7: å›¾ç‰‡ä¸Šä¼ å¤±è´¥?

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:

1. **ä¸Šä¼ ç›®å½•æƒé™:**
   ```bash
   mkdir -p public/uploads
   chmod 755 public/uploads
   ```

2. **Nginxé…ç½®:**
   ```nginx
   client_max_body_size 10M;  # å…è®¸ä¸Šä¼ æœ€å¤§10MB
   ```

3. **æ–‡ä»¶å¤§å°é™åˆ¶:** ä»£ç ä¸­é™åˆ¶ä¸º5MB

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-12-27)
âœ… **æ ¸å¿ƒåŠŸèƒ½å®Œæˆ**
- åŒAI Provideræ¶æ„(Coze + OpenAI)
- ç³»åˆ—ç›²ç›’ç³»ç»Ÿ
- æ¿€æ´»ç ç³»ç»Ÿ
- ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- åå°ç®¡ç†åŠŸèƒ½
- å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
- æ™ºèƒ½ä½“å¯¹è¯è®°å¿†

### ğŸ”„ å³å°†æ¨å‡º
- [ ] æ”¯ä»˜åŠŸèƒ½é›†æˆ
- [ ] NFCèŠ¯ç‰‡Web APIé›†æˆ
- [ ] æ™ºèƒ½ä½“åˆ†äº«åŠŸèƒ½
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] ç§»åŠ¨ç«¯ä¼˜åŒ–

---

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Request!

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤Pull Request

---

## ğŸ“ è”ç³»æ–¹å¼

- **GitHubä»“åº“:** https://github.com/emajjsky/pontaponta
- **é—®é¢˜åé¦ˆ:** åœ¨GitHubæIssue
- **éƒ¨ç½²æ–‡æ¡£:** æŸ¥çœ‹ [TENCENT_CLOUD_DEPLOYMENT.md](./TENCENT_CLOUD_DEPLOYMENT.md)

---

## ğŸŒŸ è‡´è°¢

- [Next.js](https://nextjs.org/) - Reactæ¡†æ¶
- [Prisma](https://www.prisma.io/) - æ•°æ®åº“ORM
- [shadcn/ui](https://ui.shadcn.com/) - UIç»„ä»¶åº“
- [Coze API](https://www.coze.cn/) - AIå¯¹è¯æœåŠ¡
- [Tailwind CSS](https://tailwindcss.com/) - CSSæ¡†æ¶

---

**è‰¹,è€ç‹æˆ‘æŠŠè¿™ä¸ªæ–‡æ¡£å†™å¾—è¿™ä¹ˆè¯¦ç»†,ä½ è¦æ˜¯è¿˜è¯´çœ‹ä¸æ‡‚,è€ç‹çœŸè¦æŠŠé”®ç›˜åƒä¸‹å»äº†!ğŸ‰**

**æ–‡æ¡£æœ€åæ›´æ–°: 2025-12-27**
